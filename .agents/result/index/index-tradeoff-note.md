# Result: Index Tradeoff Note

## Metadata
- **Status**: Completed
- **Date**: 2026-01-03
- **Source Request**: 인덱스 추가의 장점/오버헤드/계산법을 프로젝트 상황에 맞게 문서화

## Body

## 개요
- **핵심 요지**: 인덱스는 **읽기 성능 향상**을 위해 **쓰기 성능과 디스크/메모리 자원**을 지불하는 거래입니다.
- **현재 결론**: 이번에 추가한 인덱스들은 **조회 빈도가 높은 핵심 경로**를 대상으로 하며, 일반적인 **Read:Write = 8:2 ~ 9:1** 서비스에서 **매우 합리적인 투자**입니다.

## 장점 (Benefit)
- **Latency 감소**
  - 풀 스캔 **O(N)** -> B-Tree 탐색 **O(log N)**.
  - 데이터 규모가 커질수록 체감 개선 폭이 커집니다.
- **CPU 사용량 감소**
  - **filesort 제거**가 핵심. 정렬이 인덱스로 해결되어 CPU 부담이 급감합니다.
- **Locking 시간 단축**
  - 필요한 Row만 탐색/잠금. 동시성 저하 위험이 줄어듭니다.

## 오버헤드 (Cost)
- **쓰기 성능 저하**
  - INSERT/UPDATE/DELETE 시 **보조 인덱스까지 갱신** 필요.
  - B-Tree 특성상 **페이지 분할(Page Split)** 가능성 존재.
- **메모리(Buffer Pool) 점유**
  - 자주 쓰이는 인덱스는 메모리에 상주하므로 유리.
  - 미사용 인덱스는 캐시 공간 낭비.
- **디스크 용량 증가**
  - 인덱스가 데이터 용량을 넘어서는 경우도 가능.

## 대략적 계산법 (Estimation)

### A. 용량(Storage) 추정
- **공식**

```text
(인덱스 컬럼 크기 + 오버헤드) x 행 개수
```

- **예시: reading / idx_reading_member_created_at**
  - member_id (BIGINT 8B) + created_at (DATETIME 8B) = 16B
  - 레코드 포인터 및 헤더 오버헤드: 10~14B
  - **Row당 약 30B**
  - 1,000만 건 기준 약 **300MB**
- **판단**: 수십 GB~TB 디스크 기준에서는 **무시 가능한 수준**입니다.

### B. 메모리(Buffer Pool) 영향
- 4GB 메모리 환경에서 300MB 인덱스는 **약 7.5%**.
- **판단 기준**: 자주 조회되는 인덱스라면 상주가 이득이며, 이번 인덱스들은 모두 Core Query에 해당합니다.

### C. 쓰기 지연(Write Latency) 예측
- **공식(경향)**

```text
기본 쓰기 시간 + (인덱스 개수 x 0.x ms)
```

- InnoDB의 **Change Buffer** 덕분에, 인덱스 1~2개 추가로 즉시 체감 지연이 발생하지는 않습니다.
- **위험 구간**: 인덱스가 10~15개 이상이거나 **긴 문자열 인덱스**가 많을 때.
- **현재 상황**: 정수/날짜 위주 인덱스이므로 **안전한 수준**입니다.

## 프로젝트 기준 트레이드오프 판단

### 현재 적용 인덱스 성격
- **대상 컬럼**: PK, FK, 정렬(created_at), 상태값(status), 공개 여부(is_public)
- **테이블당 개수**: 3~5개 수준
- **업무 특성**: 피드/목록 조회 중심의 Read-heavy

### 최종 판단
- **ROI 최상**: filesort 제거와 풀 스캔 감소로 **읽기 효율이 크게 개선**됨.
- **안전 범위**: 테이블당 5개 내외의 정수/날짜 인덱스는 MySQL에서 부담이 낮음.

## 주의 사항
- **status 변경 빈도**
  - `reading.status` 는 인덱스에 포함되어 있어 변경이 잦을 경우 갱신 비용이 발생합니다.
  - **조회 빈도 > 변경 빈도** 상황에서는 충분히 감수 가능한 비용입니다.
- **지표 기반 검증 권장**
  - **Slow Query Log**, **EXPLAIN**, **Buffer Pool Hit Ratio** 를 통해 지속 관찰.

## 결론
- 현재 인덱스 구성은 **Read 성능을 크게 개선**하면서도 **Write/자원 오버헤드는 관리 가능한 수준**입니다.
- 트래픽 증가 시에도 확장에 유리한 구조이며, 큰 리스크 없이 적용 가능한 튜닝으로 판단됩니다.
